DELIMITER $$
CREATE FUNCTION GetWordScore(w VARCHAR(200), d INT) RETURNS FLOAT(4) DETERMINISTIC
BEGIN
  DECLARE score FLOAT(4) DEFAULT 0.0;
  SELECT FREQ INTO score FROM INVINDEX WHERE WORD = w and DOC_ID = d;
  SELECT score/SUM(FREQ) INTO score FROM INVINDEX WHERE DOC_ID = d;
  RETURN score;
END $$
DELIMITER ;

SELECT WORD, AVG(GetWordScore(WORD, DOC_ID)) as AvgScore 
FROM INVINDEX 
GROUP BY WORD 
ORDER BY AvgScore DESC;